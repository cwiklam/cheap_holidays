<div class="w-full text-left max-w-4xl mx-auto space-y-8">
  <div class="flex items-center justify-between flex-wrap gap-4">
    <h1 class="text-3xl font-bold">Offers for <%= @travel_agency.name %></h1>
    <div class="flex gap-2">
      <%= link_to "Back to Agency", @travel_agency, class: "btn btn-sm" %>
      <%= link_to "All Agencies", travel_agencies_path, class: "btn btn-ghost btn-sm" %>
    </div>
  </div>

  <%= form_with url: offers_current_path, method: :get, local: true, class: "flex gap-2 items-end" do %>
    <div class="flex-1">
      <label class="label" for="q">Search offers</label>
      <input type="text" name="q" id="q" value="<%= @query %>" class="input input-bordered w-full" placeholder="e.g. Greece, City Break" />
    </div>
    <div class="pb-1">
      <button class="btn btn-primary" type="submit">Search</button>
    </div>
  <% end %>

  <% if @fetch_error %>
    <div class="alert alert-error"><%= @fetch_error %></div>
  <% end %>

  <% if @offers.any? %>
    <div class="grid md:grid-cols-2 gap-6">
      <% @offers.each do |offer| %>
        <div class="card bg-base-200 shadow overflow-hidden">
          <% if offer[:image_url] %>
            <figure class="h-40 w-full overflow-hidden bg-base-300">
              <img src="<%= offer[:image_url] %>" alt="<%= offer[:name] %>" class="object-cover w-full h-full" loading="lazy">
            </figure>
          <% end %>
          <div class="card-body space-y-2">
            <h2 class="card-title">
              <% if offer[:url] %>
                <%= link_to offer[:name], offer[:url], target: "_blank", rel: "noopener" %>
              <% else %>
                <%= offer[:name] %>
              <% end %>
              <% if offer[:country].present? %>
                <span class="badge badge-outline ml-2"><%= offer[:country] %></span>
              <% end %>
            </h2>
            <% if offer[:starts_on].present? %>
              <p class="opacity-80 text-sm">Term: <%= offer[:starts_on] %></p>
            <% end %>
            <% if offer[:price] %>
              <p class="font-semibold text-lg">
                <%= number_with_precision(offer[:price], precision: 2) %> <span class="opacity-70 text-sm ml-1">(<%= offer[:price_raw] %>)</span>
              </p>
            <% end %>
          </div>
        </div>
      <% end %>
    </div>
  <% else %>
    <p class="opacity-70">No offers match your search.</p>
  <% end %>

  <% if params[:debug] && @scrape_info.present? %>
    <details class="mt-10">
      <summary class="cursor-pointer underline text-sm">Debug info</summary>
      <pre class="text-xs mt-4 bg-base-200 p-4 rounded"><%= JSON.pretty_generate(@scrape_info) rescue @scrape_info.inspect %></pre>
    </details>
  <% end %>
</div>
